<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë“±ëŒ€ íƒí—˜ ê²Œì„</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root { color-scheme: dark; }
    html, body { height: 100%; }
    body { font-family: 'Noto Sans KR', system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple SD Gothic Neo", "Noto Sans KR"; }
    .fade-in { animation: fadeIn .5s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }
    .soft-glow { box-shadow: 0 0 0 1px rgba(251,191,36,.08), 0 10px 40px rgba(0,0,0,.35), inset 0 0 80px rgba(255,255,255,.02); }
  </style>
</head>
<body class="min-h-screen bg-[url('https://images.unsplash.com/photo-1500375592092-40eb2168fd21?q=80&w=1600&auto=format&fit=crop')] bg-cover bg-center">
  <div class="min-h-screen bg-black/50 flex items-center justify-center p-4">
    <main id="app" class="w-full max-w-xl mx-auto bg-slate-900/60 backdrop-blur rounded-2xl border border-white/10 p-5 sm:p-6 text-slate-100 soft-glow fade-in"></main>
  </div>

  <script>
  // --- ì €ì¥ ìœ í‹¸ (localStorage + sessionStorage + cookie) ---
  const STORE_KEY = 'lighthouse_state_v1';
  function saveState(state){
    const s = JSON.stringify(state);
    localStorage.setItem(STORE_KEY, s);
    sessionStorage.setItem(STORE_KEY, s);
    document.cookie = `${STORE_KEY}=${encodeURIComponent(s)}; path=/; max-age=${60*60*24*30}`; // 30ì¼
  }
  function loadState(){
    const fromLocal = localStorage.getItem(STORE_KEY);
    if(fromLocal){
      try { return JSON.parse(fromLocal); } catch(e){}
    }
    // ì¿ í‚¤ í´ë°±
    const match = document.cookie.match(new RegExp('(^| )'+STORE_KEY+'=([^;]+)'));
    if(match){ try { return JSON.parse(decodeURIComponent(match[2])); } catch(e){} }
    return null;
  }
  function clearState(){
    localStorage.removeItem(STORE_KEY);
    sessionStorage.removeItem(STORE_KEY);
    document.cookie = `${STORE_KEY}=; Max-Age=0; path=/`;
  }

  // --- ë°ì´í„° ëª¨ë¸ ---
  const FLOORS = {
    1: {
      title: '1ì¸µ â€” ì…êµ¬Â·ê´€ë¦¬ êµ¬ì—­',
      arrivalStory: 'ë¬´ê±°ìš´ ë¬¸ì„ ì—´ì ìŠµê¸°ì™€ ì˜¤ë˜ëœ ê¸°ë¦„ ëƒ„ìƒˆê°€ ë°€ë ¤ì˜¨ë‹¤. ë²½ì—ëŠ” ë°”ëœ í‘œì§€íŒì´ ê±¸ë ¤ ìˆê³ , ì†ì§ˆì´ ëœ ëœ í”ì ì´ ë³´ì¸ë‹¤.',
      backLabel: 'ì´ì „ ë‹¨ê³„',
      surveyLabel: '1ì¸µì„ ì¡°ì‚¬í•˜ê¸°',
      keyPlace: 'ì—°ë£Œí†µ ë³´ê´€ì‹¤', // ì´ ë‹¨ì„œë¥¼ ì–»ì–´ì•¼ ë‹¤ìŒ ì¸µ ì§„ì… ê°€ëŠ¥
      places: [
        {name: 'ì¶œì…ë¬¸', result: 'ì ê¸ˆ ìƒíƒœëŠ” ì •ìƒì´ë‹¤. ë¶ˆë¹› í”ë“¤ë¦¼ê³¼ì˜ ì—°ê´€ì„±ì€ ë‚®ë‹¤.'},
        {name: 'ë³´ê´€ ì°½ê³ ', result: "ë‚¡ì€ ì—°ë£Œí†µê³¼ ë§ˆëª¨ëœ ì¥ë¹„ê°€ ë³´ì¸ë‹¤. ê´€ë¦¬ ì£¼ê¸° ì¶•ì†Œê°€ ì˜ì‹¬ëœë‹¤."},
        {name: 'ì—°ë£Œí†µ ë³´ê´€ì‹¤', result: 'ì—°ë£Œí†µ í‘œë©´ì— ë¯¸ì„¸í•œ ê· ì—´ê³¼ ì—¼ë¶„ ê²°ì •ì´ ë³´ì¸ë‹¤. ì¦‰ê°ì ì¸ ì›ì¸ì€ ì•„ë‹ˆë‚˜, ì—¼ë¶„ ìœ ì…ê³¼ ìœ ì§€ë³´ìˆ˜ ì§€ì—°ì˜ ì‹ í˜¸ë‹¤.', important: true},
        {name: 'ë°œì „ê¸°ì‹¤', result: 'ì¶œë ¥ê³¼ ì£¼íŒŒìˆ˜ëŠ” ì•ˆì •ì ì´ë‹¤. ë‹¨ê¸° ë¡œê·¸ì— ì „ì•• ê°•í•˜ í”ì ì€ ì—†ë‹¤.'}
      ]
    },
    2: {
      title: '2ì¸µ â€” ê´€ì œÂ·ê¸°ë¡ êµ¬ì—­',
      arrivalStory: 'ì¢ì€ ë³µë„ë¥¼ ì§€ë‚˜ ê´€ì œì‹¤ì— ë“¤ì–´ì„œë©´ ë¨¼ì§€ ìŒ“ì¸ ê¸°ë¡ì§€ ì‚¬ì´ë¡œ ë°”ëŒì´ ìŠ¤ë¯¼ë‹¤. í¬ë¯¸í•œ í”ë“¤ë¦¼ì´ ë²½ì„ ë”°ë¼ ì§€ë‚˜ê°„ë‹¤.',
      backLabel: 'ì´ì „ ë‹¨ê³„',
      surveyLabel: '2ì¸µì„ ì¡°ì‚¬í•˜ê¸°',
      keyPlace: 'ë¬´ì „ê¸° ì˜† ì„œë',
      places: [
        {name: 'ê´€ì œì‹¤ ì±…ìƒ', result: 'ìµœê·¼ ì ê²€í‘œì—ì„œ ê²°ë¡œ ê²½ë³´ ì„¼ì„œ í•­ëª©ì´ ì‚¬ë¼ì¡Œë‹¤. ì ê²€ ë²”ìœ„ ì¶•ì†Œ ì •í™©ì´ë‹¤.'},
        {name: 'ì°½ë¬¸', result: 'ì°½í‹€ íŒ¨í‚¹ì´ ê²½í™”ë˜ì–´ í•´í’ì´ ì§ì ‘ ë“¤ì–´ì˜¨ë‹¤. ì—¼ë¶„ê³¼ ìŠµê¸°ì˜ ìœ ì… í†µë¡œë‹¤.'},
        {name: 'ë‚¡ì€ ì „ë“±', result: 'ë‚´ë¶€ ì¡°ëª…ë§Œ ê°„í—ì ìœ¼ë¡œ ê¹œë¹¡ì¸ë‹¤. ë“±ëŒ€ ì™¸ë¶€ ê´‘ì›ê³¼ëŠ” ì§ì ‘ ê´€ë ¨ ì—†ë‹¤.'},
        {name: 'ë¬´ì „ê¸° ì˜† ì„œë', result: 'ë¯¸ì„¸ ë¶€ì‹ ì¬ë°œ ë³´ê³ ì„œê°€ ë°˜ë³µëœë‹¤. ì¡°ì¹˜ ì´ë ¥ì€ ë¹ˆì•½í•˜ê³  ë¹„ìš© ì ˆê° í‘œì‹œê°€ ë³´ì¸ë‹¤.', important: true}
      ]
    },
    3: {
      title: '3ì¸µ â€” ë¶ˆë¹› í•µì‹¬ êµ¬ì—­',
      arrivalStory: 'í”„ë ˆë„¬ ë Œì¦ˆê°€ ë¹›ì„ ëª¨ìœ¼ê³  ë°˜ì‚¬íŒì´ ë°”ë‹¤ë¡œ ì˜ì•„ ë³´ë‚¸ë‹¤. ê³µê¸°ì—ëŠ” ì—¼ë¶„ê¸°ì™€ ìŠµê¸°ê°€ ë‚¨ì•„ ìˆë‹¤.',
      backLabel: 'ì´ì „ ë‹¨ê³„',
      surveyLabel: '3ì¸µì„ ì¡°ì‚¬í•˜ê¸°',
      keyPlace: 'ì œì–´ íŒ¨ë„',
      places: [
        {name: 'ë‚˜ì„ í˜• ê³„ë‹¨', result: 'ë‚œê°„ì— ì—¼ë¶„ ë°±í™”ê°€ ë³´ì¸ë‹¤. êµ¬ì¡° ì•ˆì „ ì´ìŠˆì´ì§€ë§Œ ì§ì ‘ ì›ì¸ì€ ì•„ë‹ˆë‹¤.'},
        {name: 'ë Œì¦ˆ ì²­ì†Œ ë„êµ¬í•¨', result: 'ë„êµ¬ ë°°ì¹˜ê°€ ì–´ê¸‹ë‚˜ ìˆê³  ì²­ì†Œ ì£¼ê¸°ê°€ ê¸¸ì–´ì§„ í”ì ì´ ìˆë‹¤.'},
        {name: 'ë¶ˆë¹› ë°˜ì‚¬íŒ ë’¤í¸', result: 'ì†Œê¸ˆê°€ë£¨ì™€ ë¨¼ì§€ê°€ ë‚¨ì•„ ìˆë‹¤. ë°”ëŒê¸¸ì´ ì œì–´ë¶€ ìª½ìœ¼ë¡œ í˜•ì„±ëœ í”ì ì´ë‹¤.'},
        {name: 'ì œì–´ íŒ¨ë„', result: 'ë³´í˜¸ íŒ¨í‚¹ ì†ìƒìœ¼ë¡œ ê²°ë¡œê°€ ìœ ì…ë˜ì—ˆë‹¤. ë°°ì„  ì¼ë¶€ê°€ ë¶€ì‹ë˜ì–´ ì ‘ì´‰ ë¶ˆëŸ‰ì´ ë°œìƒí•œë‹¤.', important: true}
      ]
    }
  };

  // --- ì´ˆê¸° ìƒíƒœ ---
  const initialState = {
    screen: 'home', // 'home' | 'floor' | 'placeResult' | 'gatePrompt' | 'repair' | 'success'
    floor: 1,
    lastPlace: null,
    clues: {1:false, 2:false, 3:false}, // ì¸µë³„ í•µì‹¬ ë‹¨ì„œ íšë“ ì—¬ë¶€
  };

  let state = loadState() || initialState;

  // --- ë Œë”ëŸ¬ ---
  const $app = document.getElementById('app');

  function render(){
    saveState(state);
    if(state.screen === 'home') return renderHome();
    if(state.screen === 'floor') return renderFloor(state.floor);
    if(state.screen === 'placeResult') return renderPlaceResult();
    if(state.screen === 'gatePrompt') return renderGatePrompt();
    if(state.screen === 'repair') return renderRepair();
    if(state.screen === 'success') return renderSuccess();
  }

  function buttonBase(cls=''){ return `inline-flex items-center justify-center px-4 py-4 text-base sm:text-lg font-semibold rounded-xl transition focus:outline-none focus:ring-2 focus:ring-yellow-300/40 ${cls}`; }

  function renderHome(){
    $app.innerHTML = `
      <section class="space-y-6 fade-in">
        <header class="space-y-2">
          <h1 class="text-2xl sm:text-3xl font-bold text-yellow-300">ë“±ëŒ€ íƒí—˜ ê²Œì„</h1>
          <p class="text-base sm:text-lg text-slate-200 leading-relaxed">ë“±ëŒ€ì˜ ë¶ˆë¹›ì´ ê°„í—ì ìœ¼ë¡œ í”ë“¤ë¦°ë‹¤. ì›ì¸ì„ íŠ¹ì •í•˜ë ¤ë©´ ëª¨ë“  ì¸µì„ ì²´ê³„ì ìœ¼ë¡œ í™•ì¸í•´ì•¼ í•œë‹¤. ì‘ì€ ë‹¨ì„œë¼ë„ ë†“ì¹˜ë©´ í•­ë¡œëŠ” ë‹¤ì‹œ ì–´ë‘ ì— ê°‡íŒë‹¤.</p>
        </header>
        <div class="flex gap-3">
          <button class="${buttonBase('bg-amber-600 hover:bg-amber-500') }" onclick="gotoFloor(1)">ğŸ” ì›ì¸ ì¡°ì‚¬</button>
          <button class="${buttonBase('bg-slate-700 hover:bg-slate-600')}" onclick="resetProgress()">ì´ˆê¸°í™”</button>
        </div>
      </section>
    `;
  }

  function renderFloor(floor){
    const f = FLOORS[floor];
    const placesHtml = f.places.map(p => {
      return `<li class="mb-2"><button class="${buttonBase('w-full bg-slate-800 hover:bg-slate-700 text-left')}" onclick="investigate('${p.name.replace(/'/g, "&#39;")}')">${p.name}</button></li>`;
    }).join('');

    // ìƒë‹¨ ë‘ ê°œ ë²„íŠ¼: ì´ì „ ë‹¨ê³„, Xì¸µì„ ì¡°ì‚¬í•˜ê¸°
    const backBtn = `<button class="${buttonBase('bg-slate-700 hover:bg-slate-600')}" onclick="goBackFromFloor()">${f.backLabel}</button>`;
    const surveyBtn = `<a href="#places" class="${buttonBase('bg-amber-600 hover:bg-amber-500')}">${f.surveyLabel}</a>`;

    // ë‹¤ìŒ ì¸µìœ¼ë¡œ ì´ë™ ê°€ëŠ¥ ì—¬ë¶€ëŠ” í•µì‹¬ ë‹¨ì„œ íšë“ ì´í›„ gatePromptì—ì„œ ì²˜ë¦¬

    $app.innerHTML = `
      <section class="space-y-6 fade-in">
        <header class="space-y-2">
          <h2 class="text-xl sm:text-2xl font-bold text-yellow-300">${f.title}</h2>
          <p class="text-base sm:text-lg leading-relaxed">${f.arrivalStory}</p>
        </header>

        <div class="flex gap-3">${backBtn}${surveyBtn}</div>

        <section id="places" class="space-y-3">
          <h3 class="text-lg sm:text-xl font-semibold text-slate-100">ì¡°ì‚¬ ì¥ì†Œ</h3>
          <ul class="list-none">${placesHtml}</ul>
          <p class="text-sm text-slate-300">ì¥ì†Œëª…ì„ ëˆ„ë¥´ë©´ ê²°ê³¼ê°€ í‘œì‹œëœë‹¤.</p>
        </section>

        ${ state.clues[floor] ? gateNoticeHtml(floor) : ''}
      </section>
    `;
  }

  function gateNoticeHtml(floor){
    // í•µì‹¬ ë‹¨ì„œ íšë“ ì‹œ, í˜„ì¬ ì¸µ í•˜ë‹¨ì— ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ í‘œì‹œ
    const nextFloor = floor < 3 ? (floor + 1) : null;
    const stayLabel = `${floor}ì¸µì— ë¨¸ë¬´ë¥´ê¸°`;
    const goLabel = nextFloor ? `${nextFloor}ì¸µìœ¼ë¡œ ì˜¬ë¼ê°€ê¸°` : 'ìˆ˜ë¦¬ ì§€ì‹œí•˜ëŸ¬ ê°€ê¸°';
    const goAction = nextFloor ? `gotoFloor(${nextFloor})` : `gotoRepair()`;
    return `
      <div class="mt-4 p-4 bg-emerald-900/20 border border-emerald-400/30 rounded-xl">
        <p class="mb-3">ì´ ì¸µì—ì„œ ì–»ì„ ìˆ˜ ìˆëŠ” ì¤‘ìš”í•œ ë‹¨ì„œëŠ” ì „ë¶€ ì°¾ì€ ê²ƒ ê°™ë‹¤. ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í• ê¹Œ?</p>
        <div class="flex gap-3">
          <button class="${buttonBase('bg-slate-700 hover:bg-slate-600')}" onclick="gotoFloor(${floor})">${stayLabel}</button>
          <button class="${buttonBase('bg-amber-600 hover:bg-amber-500')}" onclick="${goAction}">${goLabel}</button>
        </div>
      </div>`;
  }

  function renderPlaceResult(){
    const f = FLOORS[state.floor];
    const place = f.places.find(p => p.name === state.lastPlace);
    $app.innerHTML = `
      <section class="space-y-6 fade-in">
        <header class="space-y-2">
          <p class="text-sm text-slate-300">${f.title}</p>
          <h3 class="text-xl sm:text-2xl font-bold text-yellow-300">${place.name}</h3>
        </header>
        <article class="text-base sm:text-lg leading-relaxed">${place.result}</article>
        <div class="flex gap-3">
          <button class="${buttonBase('bg-slate-700 hover:bg-slate-600')}" onclick="gotoFloor(${state.floor})">â† ëŒì•„ê°€ê¸°</button>
          ${ state.clues[state.floor] ? `<button class="${buttonBase('bg-amber-600 hover:bg-amber-500')}" onclick="gotoGatePrompt()">ë‹¤ìŒ ë‹¨ê³„ í™•ì¸</button>` : ''}
        </div>
      </section>
    `;
  }

  function renderGatePrompt(){
    const floor = state.floor;
    $app.innerHTML = `
      <section class="space-y-6 fade-in">
        <header>
          <h3 class="text-xl sm:text-2xl font-bold text-yellow-300">ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰</h3>
        </header>
        <p class="text-base sm:text-lg">ì´ ì¸µì—ì„œ ì–»ì„ ìˆ˜ ìˆëŠ” ì¤‘ìš”í•œ ë‹¨ì„œëŠ” ì „ë¶€ ì°¾ì€ ê²ƒ ê°™ë‹¤. ë‹¤ìŒ ì¸µìœ¼ë¡œ ì˜¬ë¼ê°ˆê¹Œ?</p>
        <div class="flex gap-3">
          <button class="${buttonBase('bg-slate-700 hover:bg-slate-600')}" onclick="gotoFloor(${floor})">${floor}ì¸µì— ë¨¸ë¬´ë¥´ê¸°</button>
          ${ floor < 3
            ? `<button class="${buttonBase('bg-amber-600 hover:bg-amber-500')}" onclick="gotoFloor(${floor+1})">${floor+1}ì¸µìœ¼ë¡œ ì˜¬ë¼ê°€ê¸°</button>`
            : `<button class="${buttonBase('bg-amber-600 hover:bg-amber-500')}" onclick="gotoRepair()">ìˆ˜ë¦¬ ì§€ì‹œí•˜ëŸ¬ ê°€ê¸°</button>`
          }
        </div>
      </section>
    `;
  }

  function renderRepair(){
    // 3ì¸µ í•µì‹¬ ë‹¨ì„œ(ì œì–´ íŒ¨ë„) í™•ë³´ í›„ì—ë§Œ ì ‘ê·¼
    const options = ['ì—°ë£Œí†µ ë³´ê´€ì‹¤','ë°œì „ê¸°ì‹¤','ë‚¡ì€ ì „ë“±','ì œì–´ íŒ¨ë„'];
    const list = options.map((o,i)=>`<li class="mb-2"><span class="inline-flex min-w-[1.75rem] justify-center font-semibold text-slate-900 bg-yellow-300 rounded mr-2">${i+1}</span>${o}</li>`).join('');
    $app.innerHTML = `
      <section class="space-y-6 fade-in">
        <header class="space-y-2">
          <h2 class="text-xl sm:text-2xl font-bold text-yellow-300">ìˆ˜ë¦¬ ì§€ì‹œ</h2>
          <p class="text-base sm:text-lg">ìˆ˜ë¦¬ê³µì´ ë„ì°©í–ˆë‹¤. ì–´ë””ë¥¼ ìš°ì„  ê³ ì³ì•¼ í•˜ëŠ”ì§€ ì •í™•íˆ ì…ë ¥í•˜ë¼.</p>
        </header>

        <div class="p-4 rounded-xl border border-white/10 bg-slate-800/60">
          <p class="mb-3 text-sm text-slate-300">ê´€ë ¨ ì„ íƒì§€</p>
          <ul class="text-base sm:text-lg leading-relaxed list-none">${list}</ul>
        </div>

        <label class="block text-sm text-slate-300">ê´€ë ¨ ì„ íƒì§€ 4ê°œ ì¥ì†Œ ì¤‘ í•˜ë‚˜ë¥¼ ì •í™•íˆ ì…ë ¥(ë„ì–´ì“°ê¸° í¬í•¨ ì™„ì „ ì¼ì¹˜)</label>
        <input id="repairInput" type="text" class="w-full rounded-xl bg-slate-800/70 border border-white/10 px-4 py-3 text-base sm:text-lg focus:outline-none focus:ring-2 focus:ring-yellow-300/40" />
        <div class="flex gap-3">
          <button class="${buttonBase('bg-amber-600 hover:bg-amber-500')}" onclick="submitRepair()">ìˆ˜ë¦¬ ì§€ì‹œ</button>
          <button class="${buttonBase('bg-slate-700 hover:bg-slate-600')}" onclick="gotoFloor(3)">3ì¸µìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
          <button class="${buttonBase('bg-slate-700 hover:bg-slate-600')}" onclick="gotoFloor(2)">2ì¸µìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
        <p id="repairError" class="hidden text-rose-300 text-sm">í•´ë‹¹ ì¥ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì •í™•í•œ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
      </section>
    `;
    setTimeout(()=>document.getElementById('repairInput').focus(), 0);
  }

  function renderSuccess(){
    $app.innerHTML = `
      <section class="space-y-6 text-center fade-in">
        <div class="mx-auto w-20 h-20 rounded-full bg-yellow-300 flex items-center justify-center animate-pulse">
          <span class="text-3xl">ğŸ’¡</span>
        </div>
        <h2 class="text-2xl sm:text-3xl font-extrabold text-yellow-300">ê·¼ë³¸ ì›ì¸ í•´ê²°</h2>
        <p class="text-base sm:text-lg leading-relaxed">ì œì–´ íŒ¨ë„ì˜ ì†ìƒëœ ë°°ì„ ì„ ìˆ˜ë¦¬í•˜ì˜€ë‹¤. ë˜í•œ ì°½í‹€ íŒ¨í‚¹ êµì²´ì™€ ì ê²€ í•­ëª© ë³µì›ì„ í†µí•´ ì—¼ë¶„Â·ìŠµê¸° ìœ ì…ê³¼ ê´€ë¦¬ ì£¼ê¸° ì¶•ì†Œë¼ëŠ” ê·¼ë³¸ ì›ì¸ì— ëŒ€í•œ ì§€ì† ì¡°ì¹˜ë¥¼ ë§ˆë ¨í•˜ì˜€ë‹¤. ë“±ëŒ€ì˜ ë¶ˆë¹›ì€ ë‹¤ì‹œ ì•ˆì •ì ìœ¼ë¡œ ë°”ë‹¤ë¥¼ ë¹„ì¶˜ë‹¤.</p>
        <div class="p-4 bg-emerald-900/20 border border-emerald-400/30 rounded-xl">
          <p class="text-lg sm:text-xl font-semibold">Ground Rule</p>
          <p class="mt-1 text-base sm:text-lg">ë¬¸ì œëŠ” ëê¹Œì§€ ì¶”ì í•´ í•´ê²°í•œë‹¤</p>
        </div>
        <div class="flex justify-center gap-3">
          <button class="${buttonBase('bg-slate-700 hover:bg-slate-600')}" onclick="goHome()">ğŸ  í™ˆìœ¼ë¡œ</button>
          <button class="${buttonBase('bg-slate-700 hover:bg-slate-600')}" onclick="resetProgress()">ì´ˆê¸°í™”</button>
        </div>
      </section>
    `;
  }

  // --- ë™ì‘ í•¨ìˆ˜ ---
  function gotoFloor(f){
    state.screen = 'floor';
    state.floor = f;
    state.lastPlace = null;
    render();
  }
  function goHome(){ state.screen = 'home'; render(); }
  function goBackFromFloor(){
    // í™ˆìœ¼ë¡œ ë³µê·€
    goHome();
  }
  function investigate(placeName){
    const f = FLOORS[state.floor];
    const place = f.places.find(p => p.name === placeName);
    if(!place){ return; }
    state.lastPlace = place.name;
    if(place.important){ state.clues[state.floor] = true; }
    state.screen = 'placeResult';
    render();
  }
  function gotoGatePrompt(){ state.screen = 'gatePrompt'; render(); }

  function gotoRepair(){
    // 3ì¸µ í•µì‹¬ ë‹¨ì„œ í™•ì¸ ìš”êµ¬
    if(!state.clues[3]){ return; }
    state.screen = 'repair';
    render();
  }

  function submitRepair(){
    const val = (document.getElementById('repairInput').value || '').trim();
    const ok = val === 'ì œì–´ íŒ¨ë„';
    const $err = document.getElementById('repairError');
    if(!ok){
      $err.classList.remove('hidden');
      return;
    }
    $err.classList.add('hidden');
    state.screen = 'success';
    render();
  }

  function resetProgress(){
    state = JSON.parse(JSON.stringify(initialState));
    clearState();
    render();
  }

  // ì§„ì…
  render();
  </script>
</body>
</html>
